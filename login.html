<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù†Ø®Ø¨Ø©</title>
    <style>
        :root {
            --navy: #0a192f;
            --gold: #c5a059;
            --black: #050a14;
            --white: #e6f1ff;
            --gold-gradient: linear-gradient(45deg, #c5a059, #f7e0a1, #8e6d2d);
        }

        body {
            background-color: var(--black);
            color: var(--white);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        .stage {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø®Øµ (SVG) */
        .character-svg {
            position: absolute;
            width: 150px;
            bottom: 50%;
            transform: translateY(50%);
            animation: characterAction 3s ease-in-out forwards;
        }

        @keyframes characterAction {
            0% { transform: translateX(-200px) scale(0); opacity: 0; }
            20% { transform: translateX(0) scale(1); opacity: 1; }
            40% { transform: rotate(-20deg); }
            50% { transform: rotate(10deg); }
            70% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-100px); }
        }

        .briefcase {
            position: absolute;
            font-size: 50px;
            opacity: 0;
            z-index: 10;
        }

        .briefcase-anim {
            animation: throwBriefcase 3s ease-in-out forwards;
        }

        @keyframes throwBriefcase {
            0%, 45% { opacity: 0; transform: translate(-20px, 0) rotate(0); }
            50% { opacity: 1; transform: translate(0, 0) rotate(0); }
            65% { transform: translate(150px, -100px) rotate(360deg); }
            80% { transform: translate(0, 200px) rotate(720deg) scale(1.5); opacity: 1; }
            100% { transform: translate(0, 200px) scale(0); opacity: 0; }
        }

        /* ÙƒØ§Ø±Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-card {
            background: var(--navy);
            padding: 30px;
            border-radius: 25px;
            border: 2px solid var(--gold);
            width: 95%;
            max-width: 450px;
            box-shadow: 0 0 50px rgba(197,160,89,0.2);
            text-align: center;
            position: relative;
            z-index: 20;
            opacity: 0;
            transform: scale(0);
            transition: opacity 0.5s, transform 0.5s;
        }

        .card-appear {
            opacity: 1;
            transform: scale(1);
        }

        h2 { color: var(--gold); margin-bottom: 20px; font-size: 1.8rem; }
        
        input, select {
            width: 100%; 
            padding: 12px; 
            margin: 8px 0;
            background: rgba(0,0,0,0.4); 
            border: 1px solid var(--gold);
            border-radius: 10px; 
            color: white; 
            text-align: center; 
            box-sizing: border-box;
            outline: none;
        }

        select option { background: var(--navy); color: white; }

        .btn-gold {
            width: 100%; 
            padding: 14px; 
            margin-top: 15px;
            background: var(--gold-gradient);
            border: none; 
            border-radius: 10px; 
            font-weight: bold; 
            cursor: pointer;
            position: relative;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.1rem;
        }

        #laugh-bubble {
            position: absolute;
            background: white;
            color: black;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: bold;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }
        
        #laugh-bubble::after {
            content: '';
            position: absolute;
            top: 100%; left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }

        .toggle-link { color: var(--gold); cursor: pointer; margin-top: 15px; display: block; font-size: 0.9rem; }
        .hidden { display: none; }

        .input-group { text-align: right; width: 100%; }
        label { font-size: 0.8rem; color: var(--gold); margin-right: 5px; }
    </style>
</head>
<body>

<div class="stage">
    <svg class="character-svg" viewBox="0 0 200 200">
        <circle cx="100" cy="50" r="30" fill="#c5a059" /> 
        <path d="M100 80 L100 150 M100 100 L60 130 M100 100 L140 80" stroke="#c5a059" stroke-width="8" stroke-linecap="round"/> 
        <path d="M100 150 L70 190 M100 150 L130 190" stroke="#c5a059" stroke-width="8" stroke-linecap="round"/> 
    </svg>

    <div class="briefcase briefcase-anim">ğŸ’¼</div>

    <div class="login-card" id="mainCard">
        <h2 id="formTitle">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµØ±Ø­</h2>
        
        <div id="regFields" class="hidden">
            <input type="text" id="fullName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="text" id="nick" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø± (Ø§Ù„Ù„Ù‚Ø¨)">
            
            <select id="grade">
                <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø§ÙˆÙ„ </option>
                <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                <option value="4">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                <option value="5">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</option>
                <option value="6">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                <option value="7">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
                <option value="8">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù†</option>
                <option value="9">Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ø³Øº</option>               
                <option value="10">Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±</option>
                <option value="11">Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option>
                <option value="12">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø± (ØªÙˆØ¬ÙŠÙ‡ÙŠ)</option>
            </select>

            <select id="role">
                <option value="student" selected>Ø±ØªØ¨Ø©: Ø·Ø§Ù„Ø¨</option>
                <option value="teacher">Ø±ØªØ¨Ø©: Ù…Ø¹Ù„Ù…</option>
            </select>
        </div>

        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <div style="position: relative; margin-top: 10px;">
            <div id="laugh-bubble">Ù‡ÙŠÙ‡ÙŠÙ‡ÙŠ.. ÙŠØ§ Ø§Ù‡Ø¨Ù„ Ù†Ø³ÙŠØª ØªØ¹Ø¨ÙŠ ÙØ±Ø§Øº! ğŸ˜‚</div>
            <button class="btn-gold" id="submitBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
        
        <span class="toggle-link" id="toggleAuth">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§</span>
    </div>
</div>

<script type="module">
    const submitBtn = document.getElementById('submitBtn');
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('pass');
    const fullNameInput = document.getElementById('fullName');
    const laughBubble = document.getElementById('laugh-bubble');
    const regFields = document.getElementById('regFields');

    let isRegister = false;

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
    const isFormInvalid = () => {
        if (isRegister) {
            return emailInput.value === "" || passInput.value === "" || fullNameInput.value === "" || document.getElementById('grade').value === "";
        }
        return emailInput.value === "" || passInput.value === "";
    };

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‡Ø±ÙˆØ¨
    submitBtn.addEventListener('mouseover', function() {
        if (isFormInvalid()) {
            const x = Math.random() * 200 - 100; 
            const y = Math.random() * 100 - 50;
            this.style.transform = `translate(${x}px, ${y}px)`;
            laughBubble.style.opacity = "1";
            laughBubble.style.transform = `translateX(-50%) translate(${x}px, ${y}px)`;
        }
    });

    const resetBtn = () => {
        if (!isFormInvalid()) {
            submitBtn.style.transform = `translate(0, 0)`;
            laughBubble.style.opacity = "0";
        }
    };

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø²Ø±
    [emailInput, passInput, fullNameInput].forEach(el => el.addEventListener('input', resetBtn));

    setTimeout(() => {
        document.getElementById('mainCard').classList.add('card-appear');
    }, 2500); 

    // --- Firebase Logic ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDJRA6KpLir1Jo-oVqqAANOglWEBXXn8oA",
        authDomain: "eliteacademy-37bfc.firebaseapp.com",
        projectId: "eliteacademy-37bfc",
        storageBucket: "eliteacademy-37bfc.firebasestorage.app",
        messagingSenderId: "203080953628",
        appId: "1:203080953628:web:69efebccc336b79f0554d9"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    document.getElementById('toggleAuth').onclick = () => {
        isRegister = !isRegister;
        regFields.classList.toggle('hidden', !isRegister);
        document.getElementById('formTitle').innerText = isRegister ? "Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù†Ø®Ø¨Ø©" : "Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµØ±Ø­";
        document.getElementById('toggleAuth').innerText = isRegister ? "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ" : "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§";
        resetBtn();
    };

    submitBtn.onclick = async () => {
        if(isFormInvalid()) return;

        const email = emailInput.value;
        const pass = passInput.value;

        try {
            if (isRegister) {
                const nick = document.getElementById('nick').value;
                const name = fullNameInput.value;
                const grade = document.getElementById('grade').value;
                const role = document.getElementById('role').value;

                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "users", res.user.uid), { 
                    fullName: name,
                    nickname: nick, 
                    grade: grade,
                    role: role, 
                    email: email,
                    joinedAt: new Date()
                });
                alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©!");
            } else {
                await signInWithEmailAndPassword(auth, email, pass);
            }
            window.location.href = "index.html";
        } catch (err) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
        }
    };
</script>
</body>
</html>